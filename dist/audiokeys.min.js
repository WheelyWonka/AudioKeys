!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).AudioKeys=t()}}(function(){return function(){return function t(e,o,i){function s(r,a){if(!o[r]){if(!e[r]){var y="function"==typeof require&&require;if(!a&&y)return y(r,!0);if(n)return n(r,!0);var p=new Error("Cannot find module '"+r+"'");throw p.code="MODULE_NOT_FOUND",p}var _=o[r]={exports:{}};e[r][0].call(_.exports,function(t){return s(e[r][1][t]||t)},_,_.exports,t,e,o,i)}return o[r].exports}for(var n="function"==typeof require&&require,r=0;r<i.length;r++)s(i[r]);return s}}()({1:[function(t,e,o){e.exports={_addKey:function(t){if(this._isNote(t.keyCode)&&!this._isPressed(t.keyCode)){var e=this._makeNote(t.keyCode);this._state.keys=(this._state.keys||[]).concat(e),this._update()}else this._isSpecialKey(t.keyCode)&&this._specialKey(t.keyCode)},_removeKey:function(t){if(this._isPressed(t.keyCode)){for(var e,o=0;o<this._state.keys.length;o++)if(this._state.keys[o].keyCode===t.keyCode){e=this._state.keys[o];break}this._state.keys.splice(this._state.keys.indexOf(e),1),this._update()}},_isPressed:function(t){if(!this._state.keys||!this._state.keys.length)return!1;for(var e=0;e<this._state.keys.length;e++)if(this._state.keys[e].keyCode===t)return!0;return!1},_makeNote:function(t){return{keyCode:t,note:this._map(t),frequency:this._toFrequency(this._map(t)),velocity:this._state.velocity,octave:this._state.octave}},clear:function(){var t=this;t._state.buffer.forEach(function(e){e.velocity=0,t._trigger("up",e)}),t._state.keys=[],t._state.buffer=[]},_update:function(){var t=this._state.buffer;this._prioritize(),this._diff(t)},_diff:function(t){var e=this,o=t.map(function(t){return t.keyCode}),i=e._state.buffer.map(function(t){return t.keyCode}),s=[];o.forEach(function(t){-1===i.indexOf(t)&&s.push(t)});var n=[];i.forEach(function(t){-1===o.indexOf(t)&&n.push(t)}),n.forEach(function(t){for(var o=0;o<e._state.buffer.length;o++)if(e._state.buffer[o].keyCode===t){e._trigger("down",e._state.buffer[o]);break}}),s.forEach(function(o){for(var i=0;i<t.length;i++)if(t[i].keyCode===o){t[i].velocity=0,e._trigger("up",t[i]);break}})}}},{}],2:[function(t,e,o){e.exports={down:function(t){this._listeners.down=(this._listeners.down||[]).concat(t)},up:function(t){this._listeners.up=(this._listeners.up||[]).concat(t)},octaveChanged:function(t){this._listeners.octaveChanged=(this._listeners.octaveChanged||[]).concat(t)},velocityChanged:function(t){this._listeners.velocityChanged=(this._listeners.velocityChanged||[]).concat(t)},_trigger:function(t){var e=this;if(e._listeners[t]&&e._listeners[t].length){var o=Array.prototype.slice.call(arguments);o.splice(0,1),e._listeners[t].forEach(function(t){t.apply(e,o)})}},_bind:function(){var t=this;if("undefined"!=typeof window&&window.document){window.document.addEventListener("keydown",function(e){t._addKey(e)}),window.document.addEventListener("keyup",function(e){t._removeKey(e)});var e=!0;setInterval(function(){window.document.hasFocus()!==e&&((e=!e)||t.clear())},100)}}}},{}],3:[function(t,e,o){var i=t("./AudioKeys.state"),s=t("./AudioKeys.events"),n=t("./AudioKeys.mapping"),r=t("./AudioKeys.buffer"),a=t("./AudioKeys.priority"),y=t("./AudioKeys.special");function p(t){this._setState(t),this._listeners={},this._bind()}p.prototype._setState=i._setState,p.prototype._extendState=i._extendState,p.prototype.set=i.set,p.prototype.get=i.get,p.prototype.down=s.down,p.prototype.up=s.up,p.prototype.octaveChanged=s.octaveChanged,p.prototype.velocityChanged=s.velocityChanged,p.prototype._trigger=s._trigger,p.prototype._bind=s._bind,p.prototype._map=n._map,p.prototype._offset=n._offset,p.prototype._isNote=n._isNote,p.prototype._toFrequency=n._toFrequency,p.prototype._keyMap=n._keyMap,p.prototype._addKey=r._addKey,p.prototype._removeKey=r._removeKey,p.prototype._isPressed=r._isPressed,p.prototype._makeNote=r._makeNote,p.prototype.clear=r.clear,p.prototype._update=r._update,p.prototype._diff=r._diff,p.prototype._prioritize=a._prioritize,p.prototype._last=a._last,p.prototype._first=a._first,p.prototype._highest=a._highest,p.prototype._lowest=a._lowest,p.prototype._isSpecialKey=y._isSpecialKey,p.prototype._specialKey=y._specialKey,p.prototype._specialKeyMap=y._specialKeyMap,e.exports=p},{"./AudioKeys.buffer":1,"./AudioKeys.events":2,"./AudioKeys.mapping":4,"./AudioKeys.priority":5,"./AudioKeys.special":6,"./AudioKeys.state":7}],4:[function(t,e,o){e.exports={_map:function(t){return this._keyMap[this._state.rows][t]+this._offset()},_offset:function(){return this._state.rootNote-this._keyMap[this._state.rows].root+12*this._state.octave},_isNote:function(t){return!!this._keyMap[this._state.rows][t]},_toFrequency:function(t){return 440*Math.pow(2,(t-69)/12)},_keyMap:{1:{root:60,65:60,87:61,83:62,69:63,68:64,70:65,84:66,71:67,89:68,72:69,85:70,74:71,75:72,79:73,76:74,80:75,186:76,222:77},2:{root:60,90:60,83:61,88:62,68:63,67:64,86:65,71:66,66:67,72:68,78:69,74:70,77:71,188:72,76:73,190:74,186:75,191:76,81:72,50:73,87:74,51:75,69:76,82:77,53:78,84:79,54:80,89:81,55:82,85:83,73:84,57:85,79:86,48:87,80:88,219:89,187:90,221:91}}}},{}],5:[function(t,e,o){e.exports={_prioritize:function(){var t=this;t._state.keys.length?(t._state.polyphony>=t._state.keys.length?t._state.keys=t._state.keys.map(function(t){return t.isActive=!0,t}):(t._state.keys=t._state.keys.map(function(t){return t.isActive=!1,t}),t["_"+t._state.priority]()),t._state.buffer=[],t._state.keys.forEach(function(e){e.isActive&&t._state.buffer.push(e)})):t._state.buffer=[]},_last:function(){for(var t=this._state.keys.length-this._state.polyphony;t<this._state.keys.length;t++)this._state.keys[t].isActive=!0},_first:function(){for(var t=0;t<this._state.polyphony;t++)this._state.keys[t].isActive=!0},_highest:function(){var t=this._state.keys.map(function(t){return t.note});t.sort(function(t,e){return e===t?0:e<t?-1:1}),t.splice(this._state.polyphony,Number.MAX_VALUE),this._state.keys.forEach(function(e){-1!==t.indexOf(e.note)&&(e.isActive=!0)})},_lowest:function(){var t=this._state.keys.map(function(t){return t.note});t.sort(function(t,e){return t===e?0:t<e?-1:1}),t.splice(this._state.polyphony,Number.MAX_VALUE),this._state.keys.forEach(function(e){-1!==t.indexOf(e.note)&&(e.isActive=!0)})}}},{}],6:[function(t,e,o){e.exports={_isSpecialKey:function(t){return 1===this._state.rows&&this._specialKeyMap[t]},_specialKey:function(t){"octave"===this._specialKeyMap[t].type&&this._state.octaveControls?(this._state.octave+=this._specialKeyMap[t].value,this._trigger("octaveChanged",this._state.octave)):"velocity"===this._specialKeyMap[t].type&&this._state.velocityControls&&(this._state.velocity=this._specialKeyMap[t].value,this._trigger("velocityChanged",this._state.velocity))},_specialKeyMap:{90:{type:"octave",value:-1},88:{type:"octave",value:1},49:{type:"velocity",value:1},50:{type:"velocity",value:14},51:{type:"velocity",value:28},52:{type:"velocity",value:42},53:{type:"velocity",value:56},54:{type:"velocity",value:70},55:{type:"velocity",value:84},56:{type:"velocity",value:98},57:{type:"velocity",value:112},48:{type:"velocity",value:127}}}},{}],7:[function(t,e,o){e.exports={_setState:function(t){t||(t={}),this._state={},this._extendState({polyphony:4,rows:1,priority:"last",rootNote:60,octaveControls:!0,octave:0,velocityControls:!0,velocity:127,keys:[],buffer:[]}),this._extendState(t)},_extendState:function(t){for(var e in t)this._state[e]=t[e]},set:function(){return 1===arguments.length?this._extendState(arguments[0]):this._state[arguments[0]]=arguments[1],this},get:function(t){return this._state[t]}}},{}]},{},[3])(3)});